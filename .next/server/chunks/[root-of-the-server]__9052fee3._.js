module.exports=[70406,(e,t,o)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},47044,(e,t,o)=>{t.exports=e.x("jsonwebtoken-cc89c121a8bdfb14",()=>require("jsonwebtoken-cc89c121a8bdfb14"))},21503,e=>e.a(async(t,o)=>{try{let t=await e.y("pg-519b72043f8edc04");e.n(t),o()}catch(e){o(e)}},!0),64104,e=>e.a(async(t,o)=>{try{var s=e.i(21503),a=t([s]);if([s]=a.then?(await a)():a,!process.env.DATABASE_URL)throw console.error("❌ DATABASE_URL não está configurada!"),console.error("❌ Configure DATABASE_URL no arquivo .env.local ou nas variáveis de ambiente"),Error("DATABASE_URL não configurada. Configure no .env.local ou variáveis de ambiente.");let n=new s.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});n.on("connect",()=>{console.log("✅ Conectado ao banco de dados Neon")}),n.on("error",e=>{console.error("❌ Erro no pool de conexões:",e)}),e.s(["default",0,n]),o()}catch(e){o(e)}},!1),63963,e=>{"use strict";var t=e.i(47044);let o=process.env.JWT_SECRET||"your-secret-key-change-in-production";function s(e,s,a){let n=e.headers.authorization,r=n&&n.split(" ")[1];if(!r)return s.status(401).json({error:"Token não fornecido"});try{e.user=t.default.verify(r,o),a()}catch(e){return s.status(403).json({error:"Token inválido ou expirado"})}}function a(e,t,o){if(e.user?.role!=="admin")return t.status(403).json({error:"Acesso negado. Admin necessário."});o()}process.env.JWT_SECRET||console.warn("⚠️  JWT_SECRET não configurado! Usando valor padrão inseguro."),e.s(["authenticateToken",()=>s,"requireAdmin",()=>a])},82283,e=>e.a(async(t,o)=>{try{var s=e.i(63963),a=e.i(64104),n=t([a]);async function r(e,t){return(t.setHeader("Access-Control-Allow-Credentials","true"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,PUT,DELETE,OPTIONS"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"),"OPTIONS"===e.method)?void t.status(200).end():(0,s.authenticateToken)(e,t,()=>(0,s.requireAdmin)(e,t,async()=>{try{let{method:o}=e,{id:s}=e.query;if(!s||"string"!=typeof s)return t.status(400).json({error:"ID da pergunta é obrigatório"});if("GET"===o){let e=!1;try{let t=await a.default.query(`
              SELECT EXISTS (
                SELECT FROM information_schema.tables 
                WHERE table_schema = 'public' 
                AND table_name = 'question_contexts'
              )
            `);e=t.rows[0]?.exists||!1}catch{e=!1}let o="SELECT q.* FROM questions q WHERE q.id = $1";e&&(o=`SELECT q.*, qc.*
             FROM questions q
             LEFT JOIN question_contexts qc ON qc.question_id = q.id
             WHERE q.id = $1`);let n=await a.default.query(o,[s]);if(0===n.rows.length)return t.status(404).json({error:"Pergunta não encontrada"});let r=n.rows[0];if(("single_select"===r.type||"multi_select"===r.type)&&(r.options=(await a.default.query("SELECT * FROM question_options WHERE question_id = $1 ORDER BY order_index",[s])).rows),r.validation_schema&&"string"==typeof r.validation_schema)try{r.validation_schema=JSON.parse(r.validation_schema)}catch{r.validation_schema=null}return t.status(200).json(r)}if("PUT"===o){let{code:o,text:n,help_text:r,type:i,required:l,order_index:d,validation_schema:u,ai_importance_weight:c,options:_,context:h}=e.body;if(await a.default.query(`UPDATE questions SET
              code = $1, text = $2, help_text = $3, type = $4,
              required = $5, order_index = $6, validation_schema = $7,
              ai_importance_weight = $8
            WHERE id = $9`,[o,n,r||null,i,l,d,u?JSON.stringify(u):null,c||.5,s]),"single_select"===i||"multi_select"===i){if(await a.default.query("DELETE FROM question_options WHERE question_id = $1",[s]),_&&Array.isArray(_)&&_.length>0)for(let e of _)await a.default.query(`INSERT INTO question_options (question_id, label, value, order_index)
                   VALUES ($1, $2, $3, $4)`,[s,e.label,e.value,e.order_index||0])}else await a.default.query("DELETE FROM question_options WHERE question_id = $1",[s]);let p=!1;try{let e=await a.default.query(`
              SELECT EXISTS (
                SELECT FROM information_schema.tables 
                WHERE table_schema = 'public' 
                AND table_name = 'question_contexts'
              )
            `);p=e.rows[0]?.exists||!1}catch{p=!1}return void 0!==h&&p&&((await a.default.query("SELECT id FROM question_contexts WHERE question_id = $1",[s])).rows.length>0?await a.default.query(`UPDATE question_contexts SET
                  why = $1, consequences = $2, how_to_answer = $3,
                  good_examples = $4, bad_examples = $5,
                  show_why = $6, show_consequences = $7, show_how_to_answer = $8,
                  show_good_examples = $9, show_bad_examples = $10,
                  updated_at = NOW()
                WHERE question_id = $11`,[h.why||null,h.consequences&&Array.isArray(h.consequences)?h.consequences:null,h.how_to_answer||null,h.good_examples&&Array.isArray(h.good_examples)?h.good_examples:null,h.bad_examples&&Array.isArray(h.bad_examples)?h.bad_examples:null,void 0===h.show_why||h.show_why,void 0===h.show_consequences||h.show_consequences,void 0===h.show_how_to_answer||h.show_how_to_answer,void 0===h.show_good_examples||h.show_good_examples,void 0===h.show_bad_examples||h.show_bad_examples,s]):h&&(h.why||h.how_to_answer||h.consequences||h.good_examples||h.bad_examples)&&await a.default.query(`INSERT INTO question_contexts (
                  question_id, why, consequences, how_to_answer,
                  good_examples, bad_examples,
                  show_why, show_consequences, show_how_to_answer,
                  show_good_examples, show_bad_examples
                ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)`,[s,h.why||null,h.consequences&&Array.isArray(h.consequences)?h.consequences:null,h.how_to_answer||null,h.good_examples&&Array.isArray(h.good_examples)?h.good_examples:null,h.bad_examples&&Array.isArray(h.bad_examples)?h.bad_examples:null,void 0===h.show_why||h.show_why,void 0===h.show_consequences||h.show_consequences,void 0===h.show_how_to_answer||h.show_how_to_answer,void 0===h.show_good_examples||h.show_good_examples,void 0===h.show_bad_examples||h.show_bad_examples])),t.status(200).json({success:!0})}if("DELETE"===o){let e=await a.default.query("DELETE FROM questions WHERE id = $1 RETURNING id",[s]);if(0===e.rows.length)return t.status(404).json({error:"Pergunta não encontrada"});return t.status(200).json({success:!0})}return t.status(405).json({error:"Method not allowed"})}catch(e){return console.error("Erro na API de perguntas:",e),t.status(500).json({error:e.message||"Erro interno do servidor"})}}))}[a]=n.then?(await n)():n,e.s(["default",()=>r]),o()}catch(e){o(e)}},!1),2533,e=>e.a(async(t,o)=>{try{var s=e.i(93957),a=e.i(72664),n=e.i(61471),r=e.i(65751),i=e.i(82283),l=e.i(90078),d=e.i(57218),u=e.i(2576),c=t([i]);[i]=c.then?(await c)():c;let h=(0,r.hoist)(i,"default"),p=(0,r.hoist)(i,"config"),w=new n.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/admin/questions/[id]",pathname:"/api/admin/questions/[id]",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function _(e,t,o){w.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/admin/questions/[id]";a=a.replace(/\/index$/,"")||"/";let n=await w.prepare(e,t,{srcPage:a});if(!n){t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve());return}let{query:r,params:i,prerenderManifest:c,routerServerContext:_}=n;try{let o=e.method||"GET",s=(0,l.getTracer)(),n=s.getActiveScopeSpan(),u=w.instrumentationOnRequestError.bind(w),h=async n=>w.render(e,t,{query:{...r,...i},params:i,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:c.preview,propagateError:!1,dev:w.isDev,page:"/api/admin/questions/[id]",internalRevalidate:null==_?void 0:_.revalidate,onError:(...t)=>u(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=s.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=e.get("next.route");if(r){let e=`${o} ${r}`;n.setAttributes({"next.route":r,"http.route":r,"next.span_name":e}),n.updateName(e)}else n.updateName(`${o} ${a}`)});n?await h(n):await s.withPropagatedContext(e.headers,()=>s.trace(d.BaseServerSpan.handleRequest,{spanName:`${o} ${a}`,kind:l.SpanKind.SERVER,attributes:{"http.method":o,"http.target":e.url}},h))}catch(e){if(w.isDev)throw e;(0,s.sendError)(t,500,"Internal Server Error")}finally{null==o.waitUntil||o.waitUntil.call(o,Promise.resolve())}}e.s(["config",0,p,"default",0,h,"handler",()=>_]),o()}catch(e){o(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__9052fee3._.js.map