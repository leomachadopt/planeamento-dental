module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},47044,(e,t,r)=>{t.exports=e.x("jsonwebtoken-cc89c121a8bdfb14",()=>require("jsonwebtoken-cc89c121a8bdfb14"))},21503,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-519b72043f8edc04");e.n(t),r()}catch(e){r(e)}},!0),64104,e=>e.a(async(t,r)=>{try{var i=e.i(21503),o=t([i]);if([i]=o.then?(await o)():o,!process.env.DATABASE_URL)throw console.error("❌ DATABASE_URL não está configurada!"),console.error("❌ Configure DATABASE_URL no arquivo .env.local ou nas variáveis de ambiente"),Error("DATABASE_URL não configurada. Configure no .env.local ou variáveis de ambiente.");let n=new i.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});n.on("connect",()=>{console.log("✅ Conectado ao banco de dados Neon")}),n.on("error",e=>{console.error("❌ Erro no pool de conexões:",e)}),e.s(["default",0,n]),r()}catch(e){r(e)}},!1),63963,e=>{"use strict";var t=e.i(47044);let r=process.env.JWT_SECRET||"your-secret-key-change-in-production";function i(e,i,o){let n=e.headers.authorization,a=n&&n.split(" ")[1];if(!a)return i.status(401).json({error:"Token não fornecido"});try{e.user=t.default.verify(a,r),o()}catch(e){return i.status(403).json({error:"Token inválido ou expirado"})}}function o(e,t,r){if(e.user?.role!=="admin")return t.status(403).json({error:"Acesso negado. Admin necessário."});r()}process.env.JWT_SECRET||console.warn("⚠️  JWT_SECRET não configurado! Usando valor padrão inseguro."),e.s(["authenticateToken",()=>i,"requireAdmin",()=>o])},43103,e=>e.a(async(t,r)=>{try{var i=e.i(63963),o=e.i(64104),n=t([o]);async function a(t,r){return(r.setHeader("Access-Control-Allow-Credentials","true"),r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),r.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"),"OPTIONS"===t.method)?void r.status(200).end():(0,i.authenticateToken)(t,r,()=>(0,i.requireAdmin)(t,r,async()=>{try{let{id:i}=t.query;if(!i||"string"!=typeof i)return r.status(400).json({error:"ID do usuário é obrigatório"});if("GET"===t.method){let e=await o.default.query(`SELECT 
              u.id, 
              u.email, 
              u.name, 
              u.role, 
              u.clinic_id, 
              u.is_active, 
              u.last_login, 
              u.created_at,
              c.clinic_name
            FROM users u
            LEFT JOIN clinics c ON u.clinic_id = c.id
            WHERE u.id = $1`,[i]);if(0===e.rows.length)return r.status(404).json({error:"Usuário não encontrado"});let t=e.rows[0];return r.status(200).json({user:{id:t.id,email:t.email,name:t.name,role:t.role,clinicId:t.clinic_id,clinicName:t.clinic_name,isActive:t.is_active,lastLogin:t.last_login,createdAt:t.created_at}})}if("PUT"===t.method||"PATCH"===t.method){let{name:n,role:a,clinicId:s,isActive:l,password:u}=t.body;if(void 0!==a||void 0!==s){let e=await o.default.query("SELECT role, clinic_id FROM users WHERE id = $1",[i]);if(0===e.rows.length)return r.status(404).json({error:"Usuário não encontrado"});let t=void 0!==a?a:e.rows[0].role,n=void 0!==s?s:e.rows[0].clinic_id;if("admin"!==t&&!n)return r.status(400).json({error:"Usuários devem estar associados a uma clínica"});if(n){let e=await o.default.query("SELECT id FROM clinics WHERE id = $1",[n]);if(0===e.rows.length)return r.status(400).json({error:"Clínica não encontrada"})}}let d=[],c=[],p=1;if(void 0!==n&&(d.push(`name = $${p++}`),c.push(n)),void 0!==a&&(d.push(`role = $${p++}`),c.push(a)),void 0!==s&&(d.push(`clinic_id = $${p++}`),c.push(s||null)),void 0!==l&&(d.push(`is_active = $${p++}`),c.push(l)),void 0!==u){if(u.length<8)return r.status(400).json({error:"Senha deve ter no mínimo 8 caracteres"});let t=await e.A(25584),i=await t.default.hash(u,10);d.push(`password_hash = $${p++}`),c.push(i)}if(0===d.length)return r.status(400).json({error:"Nenhum campo para atualizar"});d.push("updated_at = NOW()"),c.push(i);let h=`UPDATE users SET ${d.join(", ")} WHERE id = $${p} RETURNING id, email, name, role, clinic_id, is_active`,m=await o.default.query(h,c);return r.status(200).json({user:{id:m.rows[0].id,email:m.rows[0].email,name:m.rows[0].name,role:m.rows[0].role,clinicId:m.rows[0].clinic_id,isActive:m.rows[0].is_active}})}if("DELETE"===t.method)return await o.default.query("DELETE FROM users WHERE id = $1",[i]),r.status(200).json({message:"Usuário deletado com sucesso"});return r.status(405).json({error:"Método não permitido"})}catch(e){return console.error("Erro na API de usuário:",e),r.status(500).json({error:"Erro interno do servidor"})}}))}[o]=n.then?(await n)():n,e.s(["default",()=>a]),r()}catch(e){r(e)}},!1),73977,e=>e.a(async(t,r)=>{try{var i=e.i(93957),o=e.i(72664),n=e.i(61471),a=e.i(65751),s=e.i(43103),l=e.i(90078),u=e.i(57218),d=e.i(2576),c=t([s]);[s]=c.then?(await c)():c;let h=(0,a.hoist)(s,"default"),m=(0,a.hoist)(s,"config"),v=new n.PagesAPIRouteModule({definition:{kind:o.RouteKind.PAGES_API,page:"/api/users/[id]",pathname:"/api/users/[id]",bundlePath:"",filename:""},userland:s,distDir:".next",relativeProjectDir:""});async function p(e,t,r){v.isDev&&(0,d.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let o="/api/users/[id]";o=o.replace(/\/index$/,"")||"/";let n=await v.prepare(e,t,{srcPage:o});if(!n){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:a,params:s,prerenderManifest:c,routerServerContext:p}=n;try{let r=e.method||"GET",i=(0,l.getTracer)(),n=i.getActiveScopeSpan(),d=v.instrumentationOnRequestError.bind(v),h=async n=>v.render(e,t,{query:{...a,...s},params:s,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:c.preview,propagateError:!1,dev:v.isDev,page:"/api/users/[id]",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>d(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=i.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=e.get("next.route");if(a){let e=`${r} ${a}`;n.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),n.updateName(e)}else n.updateName(`${r} ${o}`)});n?await h(n):await i.withPropagatedContext(e.headers,()=>i.trace(u.BaseServerSpan.handleRequest,{spanName:`${r} ${o}`,kind:l.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},h))}catch(e){if(v.isDev)throw e;(0,i.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,m,"default",0,h,"handler",()=>p]),r()}catch(e){r(e)}},!1),25584,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_bcryptjs_3e0b7523._.js"].map(t=>e.l(t))).then(()=>t(39090)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9557ba36._.js.map