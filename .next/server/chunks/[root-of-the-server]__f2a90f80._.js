module.exports=[70406,(e,o,t)=>{o.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},47044,(e,o,t)=>{o.exports=e.x("jsonwebtoken-cc89c121a8bdfb14",()=>require("jsonwebtoken-cc89c121a8bdfb14"))},21503,e=>e.a(async(o,t)=>{try{let o=await e.y("pg-519b72043f8edc04");e.n(o),t()}catch(e){t(e)}},!0),64104,e=>e.a(async(o,t)=>{try{var n=e.i(21503),s=o([n]);if([n]=s.then?(await s)():s,!process.env.DATABASE_URL)throw console.error("‚ùå DATABASE_URL n√£o est√° configurada!"),console.error("‚ùå Configure DATABASE_URL no arquivo .env.local ou nas vari√°veis de ambiente"),Error("DATABASE_URL n√£o configurada. Configure no .env.local ou vari√°veis de ambiente.");let r=new n.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});r.on("connect",()=>{console.log("‚úÖ Conectado ao banco de dados Neon")}),r.on("error",e=>{console.error("‚ùå Erro no pool de conex√µes:",e)}),e.s(["default",0,r]),t()}catch(e){t(e)}},!1),63963,e=>{"use strict";var o=e.i(47044);let t=process.env.JWT_SECRET||"your-secret-key-change-in-production";function n(e,n,s){let r=e.headers.authorization,a=r&&r.split(" ")[1];if(!a)return n.status(401).json({error:"Token n√£o fornecido"});try{e.user=o.default.verify(a,t),s()}catch(e){return n.status(403).json({error:"Token inv√°lido ou expirado"})}}function s(e,o,t){if(e.user?.role!=="admin")return o.status(403).json({error:"Acesso negado. Admin necess√°rio."});t()}process.env.JWT_SECRET||console.warn("‚ö†Ô∏è  JWT_SECRET n√£o configurado! Usando valor padr√£o inseguro."),e.s(["authenticateToken",()=>n,"requireAdmin",()=>s])},6264,e=>e.a(async(o,t)=>{try{var n=e.i(63963),s=e.i(64104),r=o([s]);async function a(e,o){return(o.setHeader("Access-Control-Allow-Credentials","true"),o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Access-Control-Allow-Methods","POST,OPTIONS"),o.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"),"OPTIONS"===e.method)?void o.status(200).end():(0,n.authenticateToken)(e,o,()=>(0,n.requireAdmin)(e,o,async()=>{try{if("POST"===e.method){let t,{block:n}=e.body;if(!n||!n.code||!n.questions||!Array.isArray(n.questions))return o.status(400).json({error:"Formato inv√°lido. Esperado: { block: { code, name, description, questions: [...] } }"});console.log("üì¶ Iniciando importa√ß√£o em lote"),console.log(`üìã Bloco: ${n.code}`),console.log(`üìä Perguntas: ${n.questions.length}`);let r=n.code.split("_")[0];console.log(`üîç Se\xe7\xe3o extra\xedda: ${r}`);let a=await s.default.query("SELECT id, code, name FROM sections WHERE code = $1",[r]);if(0===a.rows.length)return o.status(404).json({error:`Se\xe7\xe3o '${r}' n\xe3o encontrada`,hint:"Certifique-se de que a se√ß√£o existe no banco de dados"});let i=a.rows[0];console.log(`‚úÖ Se\xe7\xe3o encontrada: ${i.name} (${i.id})`);let l=await s.default.query(`SELECT id, name, version FROM question_sets
             WHERE section_id = $1 AND code = $2 AND is_active = true
             ORDER BY version DESC LIMIT 1`,[i.id,n.code]);l.rows.length>0?(t=l.rows[0],console.log(`üì¶ Question Set existente encontrado: ${t.name} (v${t.version})`),console.log("‚ö†Ô∏è  As perguntas ser√£o adicionadas a este question set existente")):(t=(await s.default.query(`INSERT INTO question_sets (section_id, code, name, description, version, is_active)
               VALUES ($1, $2, $3, $4, 1, true)
               RETURNING id, name, version`,[i.id,n.code,n.name,n.description||null])).rows[0],console.log(`‚úÖ Novo Question Set criado: ${t.name} (${t.id})`));let d=!1;try{let e=await s.default.query(`
              SELECT EXISTS (
                SELECT FROM information_schema.tables
                WHERE table_schema = 'public'
                AND table_name = 'question_contexts'
              )
            `);d=e.rows[0]?.exists||!1}catch{d=!1}console.log(`üìã Tabela question_contexts existe: ${d}`);let c=[],u=[],p=[];for(let e=0;e<n.questions.length;e++){let o=n.questions[e];try{console.log(`
üìù Processando pergunta ${e+1}/${n.questions.length}: ${o.code}`);let r=await s.default.query("SELECT id, text FROM questions WHERE question_set_id = $1 AND code = $2",[t.id,o.code]);if(r.rows.length>0){console.log(`‚ö†Ô∏è  Pergunta j\xe1 existe: ${o.code}`),u.push({code:o.code,reason:"J√° existe",existingId:r.rows[0].id});continue}let a=null;if(o.validation_schema&&"object"==typeof o.validation_schema){let e=Object.fromEntries(Object.entries(o.validation_schema).filter(([e,o])=>null!=o&&""!==o));Object.keys(e).length>0&&(a=JSON.stringify(e))}let i=(await s.default.query(`INSERT INTO questions (
                  question_set_id, code, text, help_text, type, required,
                  order_index, validation_schema, ai_importance_weight
                ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
                RETURNING *`,[t.id,o.code,o.text,o.help_text||null,o.type,o.required||!1,e,a,o.ai_importance_weight||.5])).rows[0];if(console.log(`‚úÖ Pergunta criada: ${i.code} (${i.id})`),("single_select"===o.type||"multi_select"===o.type)&&o.options&&Array.isArray(o.options)&&o.options.length>0){for(let e=0;e<o.options.length;e++){let t=o.options[e];await s.default.query(`INSERT INTO question_options (question_id, label, value, order_index)
                     VALUES ($1, $2, $3, $4)`,[i.id,t.label,t.value||t.label,t.order_index||e])}console.log(`   ‚úÖ ${o.options.length} op\xe7\xf5es criadas`)}if(o.context&&d){let e=o.context;await s.default.query(`INSERT INTO question_contexts (
                    question_id, why, consequences, how_to_answer,
                    good_examples, bad_examples,
                    show_why, show_consequences, show_how_to_answer,
                    show_good_examples, show_bad_examples
                  ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)`,[i.id,e.why||null,e.consequences&&Array.isArray(e.consequences)?e.consequences:null,e.how_to_answer||null,e.good_examples&&Array.isArray(e.good_examples)?e.good_examples:null,e.bad_examples&&Array.isArray(e.bad_examples)?e.bad_examples:null,void 0===e.show_why||e.show_why,void 0===e.show_consequences||e.show_consequences,void 0===e.show_how_to_answer||e.show_how_to_answer,void 0===e.show_good_examples||e.show_good_examples,void 0===e.show_bad_examples||e.show_bad_examples]),console.log(`   ‚úÖ Contexto criado`)}c.push({id:i.id,code:i.code,text:i.text})}catch(e){console.error(`‚ùå Erro ao processar pergunta ${o.code}:`,e.message),p.push({code:o.code,error:e.message})}}return console.log("\n‚úÖ Importa√ß√£o conclu√≠da"),console.log(`   Importadas: ${c.length}`),console.log(`   Ignoradas: ${u.length}`),console.log(`   Erros: ${p.length}`),o.status(200).json({success:!0,questionSet:{id:t.id,name:t.name,version:t.version},section:{id:i.id,code:i.code,name:i.name},summary:{total:n.questions.length,imported:c.length,skipped:u.length,errors:p.length},imported:c,skipped:u,errors:p})}return o.status(405).json({error:"Method not allowed"})}catch(e){return console.error("‚ùå Erro na importa√ß√£o em lote:",e),console.error("üîç Stack trace:",e.stack),o.status(500).json({error:e.message||"Erro interno do servidor",details:void 0})}}))}[s]=r.then?(await r)():r,e.s(["default",()=>a]),t()}catch(e){t(e)}},!1),86959,e=>e.a(async(o,t)=>{try{var n=e.i(93957),s=e.i(72664),r=e.i(61471),a=e.i(65751),i=e.i(6264),l=e.i(90078),d=e.i(57218),c=e.i(2576),u=o([i]);[i]=u.then?(await u)():u;let h=(0,a.hoist)(i,"default"),m=(0,a.hoist)(i,"config"),g=new r.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/admin/questions/bulk-import",pathname:"/api/admin/questions/bulk-import",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function p(e,o,t){g.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/admin/questions/bulk-import";s=s.replace(/\/index$/,"")||"/";let r=await g.prepare(e,o,{srcPage:s});if(!r){o.statusCode=400,o.end("Bad Request"),null==t.waitUntil||t.waitUntil.call(t,Promise.resolve());return}let{query:a,params:i,prerenderManifest:u,routerServerContext:p}=r;try{let t=e.method||"GET",n=(0,l.getTracer)(),r=n.getActiveScopeSpan(),c=g.instrumentationOnRequestError.bind(g),h=async r=>g.render(e,o,{query:{...a,...i},params:i,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:g.isDev,page:"/api/admin/questions/bulk-import",internalRevalidate:null==p?void 0:p.revalidate,onError:(...o)=>c(e,...o)}).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":o.statusCode,"next.rsc":!1});let e=n.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=e.get("next.route");if(a){let e=`${t} ${a}`;r.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),r.updateName(e)}else r.updateName(`${t} ${s}`)});r?await h(r):await n.withPropagatedContext(e.headers,()=>n.trace(d.BaseServerSpan.handleRequest,{spanName:`${t} ${s}`,kind:l.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},h))}catch(e){if(g.isDev)throw e;(0,n.sendError)(o,500,"Internal Server Error")}finally{null==t.waitUntil||t.waitUntil.call(t,Promise.resolve())}}e.s(["config",0,m,"default",0,h,"handler",()=>p]),t()}catch(e){t(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__f2a90f80._.js.map