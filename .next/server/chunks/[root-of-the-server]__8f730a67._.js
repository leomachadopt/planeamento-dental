module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},47044,(e,t,r)=>{t.exports=e.x("jsonwebtoken-cc89c121a8bdfb14",()=>require("jsonwebtoken-cc89c121a8bdfb14"))},21503,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-519b72043f8edc04");e.n(t),r()}catch(e){r(e)}},!0),64104,e=>e.a(async(t,r)=>{try{var s=e.i(21503),o=t([s]);if([s]=o.then?(await o)():o,!process.env.DATABASE_URL)throw console.error("❌ DATABASE_URL não está configurada!"),console.error("❌ Configure DATABASE_URL no arquivo .env.local ou nas variáveis de ambiente"),Error("DATABASE_URL não configurada. Configure no .env.local ou variáveis de ambiente.");let n=new s.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});n.on("connect",()=>{console.log("✅ Conectado ao banco de dados Neon")}),n.on("error",e=>{console.error("❌ Erro no pool de conexões:",e)}),e.s(["default",0,n]),r()}catch(e){r(e)}},!1),63963,e=>{"use strict";var t=e.i(47044);let r=process.env.JWT_SECRET||"your-secret-key-change-in-production";function s(e,s,o){let n=e.headers.authorization,i=n&&n.split(" ")[1];if(!i)return s.status(401).json({error:"Token não fornecido"});try{e.user=t.default.verify(i,r),o()}catch(e){return s.status(403).json({error:"Token inválido ou expirado"})}}function o(e,t,r){if(e.user?.role!=="admin")return t.status(403).json({error:"Acesso negado. Admin necessário."});r()}process.env.JWT_SECRET||console.warn("⚠️  JWT_SECRET não configurado! Usando valor padrão inseguro."),e.s(["authenticateToken",()=>s,"requireAdmin",()=>o])},80851,e=>e.a(async(t,r)=>{try{var s=e.i(63963),o=e.i(64104),n=t([o]);async function i(e,t){return(t.setHeader("Access-Control-Allow-Credentials","true"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"),"OPTIONS"===e.method)?void t.status(200).end():(0,s.authenticateToken)(e,t,async()=>{try{let{method:r}=e,s=e.user,n=e.query.id;if(!n)return t.status(400).json({error:"ID do dossiê é obrigatório"});let i=await o.default.query("SELECT clinic_id FROM dossiers WHERE id = $1",[n]);if(0===i.rows.length)return t.status(404).json({error:"Dossiê não encontrado"});let a=i.rows[0].clinic_id;if("admin"!==s.role&&s.clinicId!==a)return t.status(403).json({error:"Acesso negado a este dossiê"});if("GET"===r){let e=await o.default.query(`SELECT DISTINCT ON (ar.section_code)
           ar.*,
           s.name as section_name,
           s.description as section_description,
           s.order_index as section_order,
           dss.completion_percent,
           dss.status as section_status
           FROM ai_reports ar
           JOIN sections s ON s.id = ar.section_id
           LEFT JOIN dossier_sections_status dss ON dss.dossier_id = ar.dossier_id AND dss.section_id = ar.section_id
           WHERE ar.dossier_id = $1
           ORDER BY ar.section_code, ar.created_at DESC`,[n]),r=await o.default.query(`SELECT s.*, 
           COALESCE(dss.completion_percent, 0) as completion_percent,
           COALESCE(dss.status, 'not_started') as section_status
           FROM sections s
           LEFT JOIN dossier_sections_status dss ON dss.section_id = s.id AND dss.dossier_id = $1
           ORDER BY s.order_index`,[n]),s=new Map(e.rows.map(e=>[e.section_code,{id:e.id,section_code:e.section_code,section_name:e.section_name,status:e.status,created_at:e.created_at,updated_at:e.updated_at,insights:e.insights_json,prompt_key:e.prompt_key,prompt_version:e.prompt_version,model:e.model}])),i=r.rows.map(e=>{let t=s.get(e.code);return{section:{id:e.id,code:e.code,name:e.name,description:e.description,order_index:e.order_index,completion_percent:e.completion_percent,status:e.section_status},report:t||null}});return t.status(200).json(i)}return t.status(405).json({error:"Método não permitido"})}catch(e){return console.error("Erro na API de listagem de relatórios:",e),t.status(500).json({error:e.message})}})}[o]=n.then?(await n)():n,e.s(["default",()=>i]),r()}catch(e){r(e)}},!1),79797,e=>e.a(async(t,r)=>{try{var s=e.i(93957),o=e.i(72664),n=e.i(61471),i=e.i(65751),a=e.i(80851),d=e.i(90078),c=e.i(57218),l=e.i(2576),u=t([a]);[a]=u.then?(await u)():u;let _=(0,i.hoist)(a,"default"),m=(0,i.hoist)(a,"config"),E=new n.PagesAPIRouteModule({definition:{kind:o.RouteKind.PAGES_API,page:"/api/dossiers/[id]/reports",pathname:"/api/dossiers/[id]/reports",bundlePath:"",filename:""},userland:a,distDir:".next",relativeProjectDir:""});async function p(e,t,r){E.isDev&&(0,l.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let o="/api/dossiers/[id]/reports";o=o.replace(/\/index$/,"")||"/";let n=await E.prepare(e,t,{srcPage:o});if(!n){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:i,params:a,prerenderManifest:u,routerServerContext:p}=n;try{let r=e.method||"GET",s=(0,d.getTracer)(),n=s.getActiveScopeSpan(),l=E.instrumentationOnRequestError.bind(E),_=async n=>E.render(e,t,{query:{...i,...a},params:a,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:E.isDev,page:"/api/dossiers/[id]/reports",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>l(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=s.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${r} ${i}`;n.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),n.updateName(e)}else n.updateName(`${r} ${o}`)});n?await _(n):await s.withPropagatedContext(e.headers,()=>s.trace(c.BaseServerSpan.handleRequest,{spanName:`${r} ${o}`,kind:d.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},_))}catch(e){if(E.isDev)throw e;(0,s.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,m,"default",0,_,"handler",()=>p]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__8f730a67._.js.map