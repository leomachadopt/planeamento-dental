module.exports=[70406,(e,o,r)=>{o.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},47044,(e,o,r)=>{o.exports=e.x("jsonwebtoken-cc89c121a8bdfb14",()=>require("jsonwebtoken-cc89c121a8bdfb14"))},21503,e=>e.a(async(o,r)=>{try{let o=await e.y("pg-519b72043f8edc04");e.n(o),r()}catch(e){r(e)}},!0),64104,e=>e.a(async(o,r)=>{try{var t=e.i(21503),n=o([t]);if([t]=n.then?(await n)():n,!process.env.DATABASE_URL)throw console.error("❌ DATABASE_URL não está configurada!"),console.error("❌ Configure DATABASE_URL no arquivo .env.local ou nas variáveis de ambiente"),Error("DATABASE_URL não configurada. Configure no .env.local ou variáveis de ambiente.");let a=new t.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});a.on("connect",()=>{console.log("✅ Conectado ao banco de dados Neon")}),a.on("error",e=>{console.error("❌ Erro no pool de conexões:",e)}),e.s(["default",0,a]),r()}catch(e){r(e)}},!1),39090,e=>e.a(async(o,r)=>{try{let o=await e.y("bcryptjs-ac70a3329b9855a7");e.n(o),r()}catch(e){r(e)}},!0),991,e=>e.a(async(o,r)=>{try{var t=e.i(47044),n=e.i(39090),a=e.i(64104),s=o([n,a]);[n,a]=s.then?(await s)():s;let l=process.env.JWT_SECRET||"your-secret-key-change-in-production",c=process.env.JWT_EXPIRES_IN||"7d";async function i(e,o){if(o.setHeader("Access-Control-Allow-Credentials","true"),o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),o.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"),"OPTIONS"===e.method)return void o.status(200).end();if("POST"!==e.method)return o.status(405).json({error:"Método não permitido"});try{let r;console.log("=== INÍCIO DO LOGIN ==="),console.log("Request method:",e.method),console.log("Request body exists:",!!e.body),console.log("Request body type:",typeof e.body),console.log("Request body:",e.body);let s=e.body;if("string"==typeof s)try{s=JSON.parse(s)}catch(e){return console.error("Erro ao parsear body:",e),o.status(400).json({error:"Body inválido"})}let{email:i,password:d}=s||{};if(!i||!d)return console.log("Email ou senha faltando:",{hasEmail:!!i,hasPassword:!!d}),o.status(400).json({error:"Email e senha são obrigatórios"});if(console.log("Tentativa de login para:",i.toLowerCase()),console.log("DATABASE_URL exists:",!!process.env.DATABASE_URL),console.log("DATABASE_URL length:",process.env.DATABASE_URL?.length||0),console.log("JWT_SECRET exists:",!!l),!a.default)throw Error("Pool de conexões não está inicializado");console.log("Executando query no banco...");try{r=await a.default.query("SELECT id, email, password_hash, name, role, clinic_id, is_active FROM users WHERE email = $1",[i.toLowerCase()]),console.log("Query executada com sucesso")}catch(e){throw console.error("❌ Erro na query do banco:",e),console.error("❌ DB Error message:",e?.message),console.error("❌ DB Error code:",e?.code),console.error("❌ DB Error detail:",e?.detail),console.error("❌ DB Error hint:",e?.hint),Error("Erro ao conectar com o banco de dados: "+e?.message)}if(console.log("Usuários encontrados:",r.rows.length),0===r.rows.length)return o.status(401).json({error:"Credenciais inválidas"});let u=r.rows[0];if(!u.is_active)return o.status(403).json({error:"Conta desativada. Entre em contato com o administrador."});console.log("Verificando senha..."),console.log("Password hash length:",u.password_hash?.length);let p=!1;try{console.log("Verificando senha com bcryptjs..."),p=await n.default.compare(d,u.password_hash),console.log("Senha válida:",p)}catch(e){throw console.error("❌ Erro ao verificar senha:",e),console.error("❌ Bcrypt error message:",e?.message),console.error("❌ Bcrypt error stack:",e?.stack),Error("Erro ao verificar senha: "+e?.message)}if(!p)return o.status(401).json({error:"Credenciais inválidas"});await a.default.query("UPDATE users SET last_login = NOW() WHERE id = $1",[u.id]),console.log("Gerando token JWT...");let h=t.default.sign({id:u.id,email:u.email,role:u.role,clinicId:u.clinic_id,name:u.name},l,{expiresIn:c});return console.log("Token gerado com sucesso"),console.log("=== LOGIN CONCLUÍDO COM SUCESSO ==="),o.status(200).json({token:h,user:{id:u.id,email:u.email,name:u.name,role:u.role,clinicId:u.clinic_id}})}catch(e){return console.error("❌ Erro no login:",e),console.error("❌ Stack trace:",e?.stack),console.error("❌ Error name:",e?.name),console.error("❌ Error code:",e?.code),o.status(500).json({error:"Erro interno do servidor",message:e?.message||"Erro desconhecido",...!1})}}e.s(["default",()=>i]),r()}catch(e){r(e)}},!1),49230,e=>e.a(async(o,r)=>{try{var t=e.i(93957),n=e.i(72664),a=e.i(61471),s=e.i(65751),i=e.i(991),l=e.i(90078),c=e.i(57218),d=e.i(2576),u=o([i]);[i]=u.then?(await u)():u;let h=(0,s.hoist)(i,"default"),g=(0,s.hoist)(i,"config"),E=new a.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function p(e,o,r){E.isDev&&(0,d.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/auth/login";n=n.replace(/\/index$/,"")||"/";let a=await E.prepare(e,o,{srcPage:n});if(!a){o.statusCode=400,o.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:s,params:i,prerenderManifest:u,routerServerContext:p}=a;try{let r=e.method||"GET",t=(0,l.getTracer)(),a=t.getActiveScopeSpan(),d=E.instrumentationOnRequestError.bind(E),h=async a=>E.render(e,o,{query:{...s,...i},params:i,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:E.isDev,page:"/api/auth/login",internalRevalidate:null==p?void 0:p.revalidate,onError:(...o)=>d(e,...o)}).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":o.statusCode,"next.rsc":!1});let e=t.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=e.get("next.route");if(s){let e=`${r} ${s}`;a.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),a.updateName(e)}else a.updateName(`${r} ${n}`)});a?await h(a):await t.withPropagatedContext(e.headers,()=>t.trace(c.BaseServerSpan.handleRequest,{spanName:`${r} ${n}`,kind:l.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},h))}catch(e){if(E.isDev)throw e;(0,t.sendError)(o,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,g,"default",0,h,"handler",()=>p]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__68ac5ef8._.js.map