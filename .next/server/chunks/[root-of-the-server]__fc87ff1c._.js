module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},47044,(e,t,r)=>{t.exports=e.x("jsonwebtoken-cc89c121a8bdfb14",()=>require("jsonwebtoken-cc89c121a8bdfb14"))},21503,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-519b72043f8edc04");e.n(t),r()}catch(e){r(e)}},!0),64104,e=>e.a(async(t,r)=>{try{var o=e.i(21503),s=t([o]);if([o]=s.then?(await s)():s,!process.env.DATABASE_URL)throw console.error("❌ DATABASE_URL não está configurada!"),console.error("❌ Configure DATABASE_URL no arquivo .env.local ou nas variáveis de ambiente"),Error("DATABASE_URL não configurada. Configure no .env.local ou variáveis de ambiente.");let a=new o.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});a.on("connect",()=>{console.log("✅ Conectado ao banco de dados Neon")}),a.on("error",e=>{console.error("❌ Erro no pool de conexões:",e)}),e.s(["default",0,a]),r()}catch(e){r(e)}},!1),63963,e=>{"use strict";var t=e.i(47044);let r=process.env.JWT_SECRET||"your-secret-key-change-in-production";function o(e,o,s){let a=e.headers.authorization,i=a&&a.split(" ")[1];if(!i)return o.status(401).json({error:"Token não fornecido"});try{e.user=t.default.verify(i,r),s()}catch(e){return o.status(403).json({error:"Token inválido ou expirado"})}}function s(e,t,r){if(e.user?.role!=="admin")return t.status(403).json({error:"Acesso negado. Admin necessário."});r()}process.env.JWT_SECRET||console.warn("⚠️  JWT_SECRET não configurado! Usando valor padrão inseguro."),e.s(["authenticateToken",()=>o,"requireAdmin",()=>s])},25310,e=>e.a(async(t,r)=>{try{var o=e.i(63963),s=e.i(64104),a=t([s]);async function i(e,t){return(t.setHeader("Access-Control-Allow-Credentials","true"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,PUT,OPTIONS"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"),"OPTIONS"===e.method)?void t.status(200).end():(0,o.authenticateToken)(e,t,()=>(0,o.requireAdmin)(e,t,async()=>{try{let r=e.query.type;if(!r)return t.status(400).json({error:"Tipo de prompt é obrigatório"});let o=null;if(r.startsWith("section_")&&(o=r.replace("section_","")),"GET"===e.method){let e=await s.default.query(`SELECT 
              system_prompt,
              user_prompt,
              key,
              version,
              section_code,
              is_active,
              created_at,
              updated_at
            FROM ai_prompt_templates
            WHERE key = $1 AND is_active = true
            ORDER BY created_at DESC
            LIMIT 1`,[r]);if(e.rows.length>0)return t.status(200).json({key:e.rows[0].key,section_code:e.rows[0].section_code,system_prompt:e.rows[0].system_prompt||"",user_prompt:e.rows[0].user_prompt||"",version:e.rows[0].version,is_active:e.rows[0].is_active,created_at:e.rows[0].created_at,updated_at:e.rows[0].updated_at});return t.status(200).json({key:r,section_code:o,system_prompt:"",user_prompt:"",version:"1.0.0",is_active:!1,created_at:null,updated_at:null})}if("PUT"===e.method){let{system_prompt:a,user_prompt:i}=e.body;if(void 0===a&&void 0===i)return t.status(400).json({error:"system_prompt ou user_prompt é obrigatório"});let n=await s.default.query(`SELECT id, version FROM ai_prompt_templates
             WHERE key = $1 AND is_active = true
             ORDER BY created_at DESC
             LIMIT 1`,[r]),d="1.0.0";if(n.rows.length>0){await s.default.query(`UPDATE ai_prompt_templates
               SET is_active = false, updated_at = NOW()
               WHERE id = $1`,[n.rows[0].id]);let e=n.rows[0].version.split("."),t=parseInt(e[1]||"0")+1;d=`${e[0]}.${t}.0`}let p=a,c=i;if(n.rows.length>0&&(void 0===a||void 0===i)){let e=await s.default.query("SELECT system_prompt, user_prompt FROM ai_prompt_templates WHERE id = $1",[n.rows[0].id]);e.rows.length>0&&(void 0===a&&(p=e.rows[0].system_prompt),void 0===i&&(c=e.rows[0].user_prompt))}let l=await s.default.query(`INSERT INTO ai_prompt_templates (
              key, version, template_text, system_prompt, user_prompt, section_code, is_active
            ) VALUES ($1, $2, $3, $4, $5, $6, true)
            RETURNING id, key, version, system_prompt, user_prompt, section_code, is_active, created_at, updated_at`,[r,d,c||"",p||"",c||"",o]);return t.status(200).json({id:l.rows[0].id,key:l.rows[0].key,section_code:l.rows[0].section_code,system_prompt:l.rows[0].system_prompt,user_prompt:l.rows[0].user_prompt,version:l.rows[0].version,is_active:l.rows[0].is_active,created_at:l.rows[0].created_at,updated_at:l.rows[0].updated_at})}return t.status(405).json({error:"Método não permitido"})}catch(e){return console.error("Erro na API de prompts:",e),t.status(500).json({error:e.message})}}))}[s]=a.then?(await a)():a,e.s(["default",()=>i]),r()}catch(e){r(e)}},!1),61347,e=>e.a(async(t,r)=>{try{var o=e.i(93957),s=e.i(72664),a=e.i(61471),i=e.i(65751),n=e.i(25310),d=e.i(90078),p=e.i(57218),c=e.i(2576),l=t([n]);[n]=l.then?(await l)():l;let m=(0,i.hoist)(n,"default"),_=(0,i.hoist)(n,"config"),v=new a.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/admin/prompts/[type]",pathname:"/api/admin/prompts/[type]",bundlePath:"",filename:""},userland:n,distDir:".next",relativeProjectDir:""});async function u(e,t,r){v.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/admin/prompts/[type]";s=s.replace(/\/index$/,"")||"/";let a=await v.prepare(e,t,{srcPage:s});if(!a){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:i,params:n,prerenderManifest:l,routerServerContext:u}=a;try{let r=e.method||"GET",o=(0,d.getTracer)(),a=o.getActiveScopeSpan(),c=v.instrumentationOnRequestError.bind(v),m=async a=>v.render(e,t,{query:{...i,...n},params:n,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:l.preview,propagateError:!1,dev:v.isDev,page:"/api/admin/prompts/[type]",internalRevalidate:null==u?void 0:u.revalidate,onError:(...t)=>c(e,...t)}).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=o.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${r} ${i}`;a.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),a.updateName(e)}else a.updateName(`${r} ${s}`)});a?await m(a):await o.withPropagatedContext(e.headers,()=>o.trace(p.BaseServerSpan.handleRequest,{spanName:`${r} ${s}`,kind:d.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},m))}catch(e){if(v.isDev)throw e;(0,o.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,_,"default",0,m,"handler",()=>u]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__fc87ff1c._.js.map