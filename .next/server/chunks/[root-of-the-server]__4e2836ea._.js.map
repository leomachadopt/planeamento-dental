{"version":3,"sources":["../../../../../Planeamento%20dental/planeamento-dental/src/lib/api-shared/db.ts","../../../../../Planeamento%20dental/planeamento-dental/src/lib/api-shared/auth.ts","../../../../../Planeamento%20dental/planeamento-dental/pages/api/admin/questions/index.ts","../../../../../Planeamento%20dental/planeamento-dental/node_modules/next/src/build/templates/pages-api.ts"],"sourcesContent":["// M√≥dulo compartilhado para API routes\r\n// Este arquivo s√≥ roda no servidor (Node.js)\r\n\r\nimport { Pool } from 'pg'\r\n\r\n// Validar DATABASE_URL\r\nif (!process.env.DATABASE_URL) {\r\n  console.error('‚ùå DATABASE_URL n√£o est√° configurada!')\r\n  console.error('‚ùå Configure DATABASE_URL no arquivo .env.local ou nas vari√°veis de ambiente')\r\n  throw new Error('DATABASE_URL n√£o configurada. Configure no .env.local ou vari√°veis de ambiente.')\r\n}\r\n\r\n// Pool de conex√µes PostgreSQL\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n  ssl: {\r\n    rejectUnauthorized: false,\r\n  },\r\n  max: 20,\r\n  idleTimeoutMillis: 30000,\r\n  connectionTimeoutMillis: 2000,\r\n})\r\n\r\npool.on('connect', () => {\r\n  console.log('‚úÖ Conectado ao banco de dados Neon')\r\n})\r\n\r\npool.on('error', (err) => {\r\n  console.error('‚ùå Erro no pool de conex√µes:', err)\r\n})\r\n\r\nexport default pool\r\n\r\n\r\n\r\n\r\n\r\n","import type { VercelRequest, VercelResponse } from '@vercel/node'\r\nimport jwt from 'jsonwebtoken'\r\n\r\nexport interface AuthRequest extends VercelRequest {\r\n  user?: {\r\n    id: string\r\n    email: string\r\n    role: 'admin' | 'user'\r\n    clinicId?: string\r\n    name: string\r\n  }\r\n}\r\n\r\n// Usar vari√°vel de ambiente ou fallback\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production'\r\n\r\nif (!process.env.JWT_SECRET) {\r\n  console.warn('‚ö†Ô∏è  JWT_SECRET n√£o configurado! Usando valor padr√£o inseguro.')\r\n}\r\n\r\nexport function authenticateToken(\r\n  req: AuthRequest,\r\n  res: VercelResponse,\r\n  next: () => void\r\n) {\r\n  const authHeader = req.headers['authorization']\r\n  const token = authHeader && authHeader.split(' ')[1]\r\n\r\n  if (!token) {\r\n    return res.status(401).json({ error: 'Token n√£o fornecido' })\r\n  }\r\n\r\n  try {\r\n    const decoded = jwt.verify(token, JWT_SECRET) as AuthRequest['user']\r\n    req.user = decoded\r\n    next()\r\n  } catch (error) {\r\n    return res.status(403).json({ error: 'Token inv√°lido ou expirado' })\r\n  }\r\n}\r\n\r\nexport function requireAdmin(\r\n  req: AuthRequest,\r\n  res: VercelResponse,\r\n  next: () => void\r\n) {\r\n  if (req.user?.role !== 'admin') {\r\n    return res.status(403).json({ error: 'Acesso negado. Admin necess√°rio.' })\r\n  }\r\n  next()\r\n}\r\n\r\nexport function optionalAuth(\r\n  req: AuthRequest,\r\n  res: VercelResponse,\r\n  next: () => void\r\n) {\r\n  const authHeader = req.headers['authorization']\r\n  const token = authHeader && authHeader.split(' ')[1]\r\n\r\n  if (token) {\r\n    try {\r\n      const decoded = jwt.verify(token, JWT_SECRET) as AuthRequest['user']\r\n      req.user = decoded\r\n    } catch (error) {\r\n      // Token inv√°lido, mas continua sem autentica√ß√£o\r\n    }\r\n  }\r\n  next()\r\n}\r\n\r\n\r\n\r\n\r\n","import type { VercelRequest, VercelResponse } from '@vercel/node'\r\nimport { authenticateToken, requireAdmin, AuthRequest } from '@/lib/api-shared/auth'\r\nimport pool from '@/lib/api-shared/db'\r\n\r\nexport default async function handler(\r\n  req: VercelRequest,\r\n  res: VercelResponse,\r\n) {\r\n  res.setHeader('Access-Control-Allow-Credentials', 'true')\r\n  res.setHeader('Access-Control-Allow-Origin', '*')\r\n  res.setHeader(\r\n    'Access-Control-Allow-Methods',\r\n    'GET,POST,OPTIONS',\r\n  )\r\n  res.setHeader(\r\n    'Access-Control-Allow-Headers',\r\n    'X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization',\r\n  )\r\n\r\n  if (req.method === 'OPTIONS') {\r\n    res.status(200).end()\r\n    return\r\n  }\r\n\r\n  return authenticateToken(req as AuthRequest, res, () => {\r\n    return requireAdmin(req as AuthRequest, res, async () => {\r\n      try {\r\n        const { method } = req\r\n\r\n        if (method === 'GET') {\r\n          const { sectionCode, questionSetId } = req.query\r\n          \r\n          console.log('üìã Buscando perguntas:', { sectionCode, questionSetId })\r\n\r\n          // Verificar se a tabela question_contexts existe\r\n          let hasQuestionContexts = false\r\n          try {\r\n            const tableCheck = await pool.query(`\r\n              SELECT EXISTS (\r\n                SELECT FROM information_schema.tables \r\n                WHERE table_schema = 'public' \r\n                AND table_name = 'question_contexts'\r\n              )\r\n            `)\r\n            hasQuestionContexts = tableCheck.rows[0]?.exists || false\r\n          } catch {\r\n            hasQuestionContexts = false\r\n          }\r\n\r\n          let query = `\r\n            SELECT \r\n              q.id,\r\n              q.code,\r\n              q.text,\r\n              q.help_text,\r\n              q.type,\r\n              q.required,\r\n              q.order_index,\r\n              q.validation_schema,\r\n              q.ai_importance_weight,\r\n              q.created_at,\r\n              q.question_set_id,\r\n              qs.section_id,\r\n              qs.name as question_set_name,\r\n              s.code as section_code,\r\n              s.name as section_name\r\n          `\r\n          \r\n          // Adicionar campos de contexto apenas se a tabela existir\r\n          if (hasQuestionContexts) {\r\n            query += `,\r\n              qc.why,\r\n              qc.consequences,\r\n              qc.how_to_answer,\r\n              qc.good_examples,\r\n              qc.bad_examples,\r\n              qc.show_why,\r\n              qc.show_consequences,\r\n              qc.show_how_to_answer,\r\n              qc.show_good_examples,\r\n              qc.show_bad_examples\r\n            FROM questions q\r\n            JOIN question_sets qs ON qs.id = q.question_set_id\r\n            JOIN sections s ON s.id = qs.section_id\r\n            LEFT JOIN question_contexts qc ON qc.question_id = q.id\r\n            WHERE qs.is_active = true\r\n          `\r\n          } else {\r\n            query += `\r\n            FROM questions q\r\n            JOIN question_sets qs ON qs.id = q.question_set_id\r\n            JOIN sections s ON s.id = qs.section_id\r\n            WHERE qs.is_active = true\r\n          `\r\n          }\r\n          const params: any[] = []\r\n          let paramIndex = 1\r\n\r\n          if (sectionCode) {\r\n            query += ` AND s.code = $${paramIndex}`\r\n            params.push(sectionCode)\r\n            paramIndex++\r\n          }\r\n\r\n          if (questionSetId) {\r\n            const qsId = Array.isArray(questionSetId) ? questionSetId[0] : questionSetId\r\n            query += ` AND q.question_set_id = $${paramIndex}`\r\n            params.push(qsId)\r\n            paramIndex++\r\n            console.log('üîç Filtrando por questionSetId:', qsId)\r\n          }\r\n\r\n          query += ` ORDER BY q.order_index`\r\n\r\n          let result\r\n          try {\r\n            console.log('üîç Executando query:', query.substring(0, 200) + '...')\r\n            console.log('üìä Par√¢metros:', params)\r\n            result = await pool.query(query, params)\r\n            console.log(`‚úÖ Query executada com sucesso. ${result.rows.length} perguntas encontradas.`)\r\n          } catch (queryError: any) {\r\n            console.error('‚ùå Erro na query SQL:', queryError)\r\n            console.error('üìù Query completa:', query)\r\n            console.error('üìä Par√¢metros:', params)\r\n            console.error('üîç Stack trace:', queryError.stack)\r\n            throw new Error(`Erro ao executar query: ${queryError.message}`)\r\n          }\r\n\r\n          console.log(`üì¶ Processando ${result.rows.length} perguntas...`)\r\n          \r\n          // Buscar op√ß√µes para cada pergunta\r\n          const questionsWithOptions = await Promise.all(\r\n            result.rows.map(async (q: any, index: number) => {\r\n              if (index === 0) {\r\n                console.log('üìã Primeira pergunta (amostra):', {\r\n                  id: q.id,\r\n                  code: q.code,\r\n                  text: q.text?.substring(0, 50),\r\n                  type: q.type,\r\n                  hasContext: !!(q.why || q.consequences || q.how_to_answer)\r\n                })\r\n              }\r\n              if (q.type === 'single_select' || q.type === 'multi_select') {\r\n                const optionsResult = await pool.query(\r\n                  'SELECT * FROM question_options WHERE question_id = $1 ORDER BY order_index',\r\n                  [q.id]\r\n                )\r\n                q.options = optionsResult.rows.map((opt: any) => ({\r\n                  id: opt.id,\r\n                  label: opt.label,\r\n                  value: opt.value,\r\n                  order_index: opt.order_index,\r\n                }))\r\n              }\r\n              \r\n              // Parse JSON fields - validation_schema √© JSONB, pode vir como objeto ou string\r\n              if (q.validation_schema) {\r\n                if (typeof q.validation_schema === 'string') {\r\n                  try {\r\n                    q.validation_schema = JSON.parse(q.validation_schema)\r\n                  } catch {\r\n                    q.validation_schema = null\r\n                  }\r\n                }\r\n                // Se j√° for objeto, manter como est√°\r\n              } else {\r\n                q.validation_schema = null\r\n              }\r\n              \r\n              // Formatar contexto se existir (apenas se a tabela question_contexts existir)\r\n              if (hasQuestionContexts) {\r\n                // Verificar se h√° algum campo de contexto n√£o nulo\r\n                const hasContext = (q.why !== null && q.why !== undefined) ||\r\n                                  (q.consequences !== null && q.consequences !== undefined) ||\r\n                                  (q.how_to_answer !== null && q.how_to_answer !== undefined) ||\r\n                                  (q.good_examples !== null && q.good_examples !== undefined) ||\r\n                                  (q.bad_examples !== null && q.bad_examples !== undefined)\r\n                \r\n                if (hasContext) {\r\n                // Tratar arrays do PostgreSQL - podem vir como array ou como string\r\n                const normalizeArray = (value: any): string[] => {\r\n                  if (!value) return []\r\n                  if (Array.isArray(value)) return value\r\n                  if (typeof value === 'string') {\r\n                    try {\r\n                      const parsed = JSON.parse(value)\r\n                      return Array.isArray(parsed) ? parsed : []\r\n                    } catch {\r\n                      return [value]\r\n                    }\r\n                  }\r\n                  return []\r\n                }\r\n                \r\n                q.context = {\r\n                  why: q.why || undefined,\r\n                  consequences: normalizeArray(q.consequences),\r\n                  how_to_answer: q.how_to_answer || undefined,\r\n                  good_examples: normalizeArray(q.good_examples),\r\n                  bad_examples: normalizeArray(q.bad_examples),\r\n                  show_why: q.show_why !== undefined && q.show_why !== null ? q.show_why : true,\r\n                  show_consequences: q.show_consequences !== undefined && q.show_consequences !== null ? q.show_consequences : true,\r\n                  show_how_to_answer: q.show_how_to_answer !== undefined && q.show_how_to_answer !== null ? q.show_how_to_answer : true,\r\n                  show_good_examples: q.show_good_examples !== undefined && q.show_good_examples !== null ? q.show_good_examples : true,\r\n                  show_bad_examples: q.show_bad_examples !== undefined && q.show_bad_examples !== null ? q.show_bad_examples : true,\r\n                  }\r\n                } else {\r\n                  q.context = undefined\r\n                }\r\n                \r\n                // Remover campos individuais do contexto para n√£o duplicar\r\n                if ('why' in q) delete q.why\r\n                if ('consequences' in q) delete q.consequences\r\n                if ('how_to_answer' in q) delete q.how_to_answer\r\n                if ('good_examples' in q) delete q.good_examples\r\n                if ('bad_examples' in q) delete q.bad_examples\r\n                if ('show_why' in q) delete q.show_why\r\n                if ('show_consequences' in q) delete q.show_consequences\r\n                if ('show_how_to_answer' in q) delete q.show_how_to_answer\r\n                if ('show_good_examples' in q) delete q.show_good_examples\r\n                if ('show_bad_examples' in q) delete q.show_bad_examples\r\n              } else {\r\n                // Se a tabela n√£o existe, contexto √© sempre undefined\r\n                q.context = undefined\r\n              }\r\n              \r\n              return q\r\n            })\r\n          )\r\n\r\n          console.log(`‚úÖ Processamento conclu√≠do. Retornando ${questionsWithOptions.length} perguntas.`)\r\n          \r\n          try {\r\n            return res.status(200).json(questionsWithOptions)\r\n          } catch (jsonError: any) {\r\n            console.error('‚ùå Erro ao serializar JSON:', jsonError)\r\n            console.error('üìã Primeira pergunta (amostra):', JSON.stringify(questionsWithOptions[0], null, 2))\r\n            throw new Error(`Erro ao serializar resposta: ${jsonError.message}`)\r\n          }\r\n        }\r\n\r\n        if (method === 'POST') {\r\n          const {\r\n            question_set_id,\r\n            code,\r\n            text,\r\n            help_text,\r\n            type,\r\n            required,\r\n            order_index,\r\n            validation_schema,\r\n            ai_importance_weight,\r\n            options,\r\n            context,\r\n          } = req.body\r\n\r\n          console.log('üìù Dados recebidos no POST:', {\r\n            question_set_id,\r\n            code,\r\n            text: text?.substring(0, 50),\r\n            type,\r\n            order_index,\r\n            validation_schema,\r\n            hasOptions: !!options,\r\n            hasContext: !!context,\r\n          })\r\n\r\n          // Validar campos obrigat√≥rios\r\n          if (!question_set_id || !code || !text || !type) {\r\n            return res.status(400).json({ error: 'Campos obrigat√≥rios: question_set_id, code, text, type' })\r\n          }\r\n\r\n          // Se order_index n√£o foi fornecido, definir como 0 (ser√° ajustado pelo frontend)\r\n          const finalOrderIndex = order_index !== undefined ? order_index : 0\r\n\r\n          // Verificar se j√° existe uma pergunta com o mesmo code no mesmo question_set_id\r\n          const existingQuestion = await pool.query(\r\n            'SELECT id, text FROM questions WHERE question_set_id = $1 AND code = $2',\r\n            [question_set_id, code]\r\n          )\r\n\r\n          if (existingQuestion.rows.length > 0) {\r\n            return res.status(409).json({ \r\n              error: 'J√° existe uma pergunta com este c√≥digo neste question set',\r\n              existingId: existingQuestion.rows[0].id,\r\n              existingText: existingQuestion.rows[0].text,\r\n              message: 'Use a edi√ß√£o para atualizar a pergunta existente ou altere o c√≥digo.'\r\n            })\r\n          }\r\n\r\n          // Processar validation_schema: remover propriedades undefined e tratar objeto vazio\r\n          let processedValidationSchema: string | null = null\r\n          if (validation_schema && typeof validation_schema === 'object') {\r\n            // Remover propriedades undefined\r\n            const cleaned = Object.fromEntries(\r\n              Object.entries(validation_schema).filter(([_, v]) => v !== undefined && v !== null && v !== '')\r\n            )\r\n            // S√≥ salvar se tiver pelo menos uma propriedade\r\n            if (Object.keys(cleaned).length > 0) {\r\n              processedValidationSchema = JSON.stringify(cleaned)\r\n            }\r\n          }\r\n\r\n          // Criar pergunta\r\n          const questionResult = await pool.query(\r\n            `INSERT INTO questions (\r\n              question_set_id, code, text, help_text, type, required,\r\n              order_index, validation_schema, ai_importance_weight\r\n            ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)\r\n            RETURNING *`,\r\n            [\r\n              question_set_id,\r\n              code,\r\n              text,\r\n              help_text || null,\r\n              type,\r\n              required || false,\r\n              finalOrderIndex,\r\n              processedValidationSchema,\r\n              ai_importance_weight || 0.5,\r\n            ]\r\n          )\r\n\r\n          const question = questionResult.rows[0]\r\n\r\n          // Criar op√ß√µes se for sele√ß√£o\r\n          if ((type === 'single_select' || type === 'multi_select') && options && Array.isArray(options)) {\r\n            for (const option of options) {\r\n              await pool.query(\r\n                `INSERT INTO question_options (question_id, label, value, order_index)\r\n                 VALUES ($1, $2, $3, $4)`,\r\n                [question.id, option.label, option.value, option.order_index || 0]\r\n              )\r\n            }\r\n          }\r\n\r\n          // Verificar se a tabela question_contexts existe antes de criar contexto\r\n          let hasQuestionContexts = false\r\n          try {\r\n            const tableCheck = await pool.query(`\r\n              SELECT EXISTS (\r\n                SELECT FROM information_schema.tables \r\n                WHERE table_schema = 'public' \r\n                AND table_name = 'question_contexts'\r\n              )\r\n            `)\r\n            hasQuestionContexts = tableCheck.rows[0]?.exists || false\r\n          } catch {\r\n            hasQuestionContexts = false\r\n          }\r\n\r\n          // Criar contexto se fornecido e se a tabela existir\r\n          if (context && hasQuestionContexts) {\r\n            await pool.query(\r\n              `INSERT INTO question_contexts (\r\n                question_id, why, consequences, how_to_answer, \r\n                good_examples, bad_examples,\r\n                show_why, show_consequences, show_how_to_answer,\r\n                show_good_examples, show_bad_examples\r\n              ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)`,\r\n              [\r\n                question.id,\r\n                context.why || null,\r\n                context.consequences && Array.isArray(context.consequences) ? context.consequences : null,\r\n                context.how_to_answer || null,\r\n                context.good_examples && Array.isArray(context.good_examples) ? context.good_examples : null,\r\n                context.bad_examples && Array.isArray(context.bad_examples) ? context.bad_examples : null,\r\n                context.show_why !== undefined ? context.show_why : true,\r\n                context.show_consequences !== undefined ? context.show_consequences : true,\r\n                context.show_how_to_answer !== undefined ? context.show_how_to_answer : true,\r\n                context.show_good_examples !== undefined ? context.show_good_examples : true,\r\n                context.show_bad_examples !== undefined ? context.show_bad_examples : true,\r\n              ]\r\n            )\r\n          }\r\n\r\n          // Buscar pergunta completa com contexto e op√ß√µes\r\n          let fullQuestionQuery = `SELECT q.* FROM questions q WHERE q.id = $1`\r\n          if (hasQuestionContexts) {\r\n            fullQuestionQuery = `SELECT q.*, qc.*\r\n             FROM questions q\r\n             LEFT JOIN question_contexts qc ON qc.question_id = q.id\r\n             WHERE q.id = $1`\r\n          }\r\n          \r\n          const fullQuestionResult = await pool.query(fullQuestionQuery, [question.id])\r\n\r\n          const fullQuestion = fullQuestionResult.rows[0]\r\n\r\n          if (fullQuestion.type === 'single_select' || fullQuestion.type === 'multi_select') {\r\n            const optionsResult = await pool.query(\r\n              'SELECT * FROM question_options WHERE question_id = $1 ORDER BY order_index',\r\n              [question.id]\r\n            )\r\n            fullQuestion.options = optionsResult.rows\r\n          }\r\n\r\n          return res.status(201).json(fullQuestion)\r\n        }\r\n\r\n        return res.status(405).json({ error: 'Method not allowed' })\r\n      } catch (error: any) {\r\n        console.error('‚ùå Erro na API de perguntas:', error)\r\n        console.error('üîç Stack trace:', error.stack)\r\n        console.error('üìã Request body:', JSON.stringify(req.body, null, 2))\r\n        console.error('üìã Request method:', req.method)\r\n        return res.status(500).json({ \r\n          error: error.message || 'Erro interno do servidor',\r\n          details: process.env.NODE_ENV === 'development' ? error.stack : undefined\r\n        })\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n","import type { NextApiResponse } from '../../types'\nimport type { IncomingMessage, ServerResponse } from 'node:http'\n\nimport { sendError } from '../../server/api-utils'\nimport { RouteKind } from '../../server/route-kind'\nimport type { Span } from '../../server/lib/trace/tracer'\nimport { PagesAPIRouteModule } from '../../server/route-modules/pages-api/module.compiled'\n\nimport { hoist } from './helpers'\n\n// Import the userland code.\nimport * as userland from 'VAR_USERLAND'\nimport { getTracer, SpanKind } from '../../server/lib/trace/tracer'\nimport { BaseServerSpan } from '../../server/lib/trace/constants'\nimport type { InstrumentationOnRequestError } from '../../server/instrumentation/types'\nimport { addRequestMeta } from '../../server/request-meta'\n\n// Re-export the handler (should be the default export).\nexport default hoist(userland, 'default')\n\n// Re-export config.\nexport const config = hoist(userland, 'config')\n\n// Create and export the route module that will be consumed.\nconst routeModule = new PagesAPIRouteModule({\n  definition: {\n    kind: RouteKind.PAGES_API,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    // The following aren't used in production.\n    bundlePath: '',\n    filename: '',\n  },\n  userland,\n  distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n  relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n})\n\nexport async function handler(\n  req: IncomingMessage,\n  res: ServerResponse,\n  ctx: {\n    waitUntil?: (prom: Promise<void>) => void\n  }\n): Promise<void> {\n  if (routeModule.isDev) {\n    addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n  }\n  let srcPage = 'VAR_DEFINITION_PAGE'\n\n  // turbopack doesn't normalize `/index` in the page name\n  // so we need to to process dynamic routes properly\n  // TODO: fix turbopack providing differing value from webpack\n  if (process.env.TURBOPACK) {\n    srcPage = srcPage.replace(/\\/index$/, '') || '/'\n  }\n\n  const prepareResult = await routeModule.prepare(req, res, { srcPage })\n\n  if (!prepareResult) {\n    res.statusCode = 400\n    res.end('Bad Request')\n    ctx.waitUntil?.(Promise.resolve())\n    return\n  }\n\n  const { query, params, prerenderManifest, routerServerContext } =\n    prepareResult\n\n  try {\n    const method = req.method || 'GET'\n    const tracer = getTracer()\n\n    const activeSpan = tracer.getActiveScopeSpan()\n    const onRequestError =\n      routeModule.instrumentationOnRequestError.bind(routeModule)\n\n    const invokeRouteModule = async (span?: Span) =>\n      routeModule\n        .render(req, res, {\n          query: {\n            ...query,\n            ...params,\n          },\n          params,\n          allowedRevalidateHeaderKeys: process.env\n            .__NEXT_ALLOWED_REVALIDATE_HEADERS as any as string[],\n          multiZoneDraftMode: Boolean(process.env.__NEXT_MULTI_ZONE_DRAFT_MODE),\n          trustHostHeader: process.env\n            .__NEXT_TRUST_HOST_HEADER as any as boolean,\n          // TODO: get this from from runtime env so manifest\n          // doesn't need to load\n          previewProps: prerenderManifest.preview,\n          propagateError: false,\n          dev: routeModule.isDev,\n          page: 'VAR_DEFINITION_PAGE',\n\n          internalRevalidate: routerServerContext?.revalidate,\n\n          onError: (...args: Parameters<InstrumentationOnRequestError>) =>\n            onRequestError(req, ...args),\n        })\n        .finally(() => {\n          if (!span) return\n\n          span.setAttributes({\n            'http.status_code': res.statusCode,\n            'next.rsc': false,\n          })\n\n          const rootSpanAttributes = tracer.getRootSpanAttributes()\n          // We were unable to get attributes, probably OTEL is not enabled\n          if (!rootSpanAttributes) {\n            return\n          }\n\n          if (\n            rootSpanAttributes.get('next.span_type') !==\n            BaseServerSpan.handleRequest\n          ) {\n            console.warn(\n              `Unexpected root span type '${rootSpanAttributes.get(\n                'next.span_type'\n              )}'. Please report this Next.js issue https://github.com/vercel/next.js`\n            )\n            return\n          }\n\n          const route = rootSpanAttributes.get('next.route')\n          if (route) {\n            const name = `${method} ${route}`\n\n            span.setAttributes({\n              'next.route': route,\n              'http.route': route,\n              'next.span_name': name,\n            })\n            span.updateName(name)\n          } else {\n            span.updateName(`${method} ${srcPage}`)\n          }\n        })\n\n    // TODO: activeSpan code path is for when wrapped by\n    // next-server can be removed when this is no longer used\n    if (activeSpan) {\n      await invokeRouteModule(activeSpan)\n    } else {\n      await tracer.withPropagatedContext(req.headers, () =>\n        tracer.trace(\n          BaseServerSpan.handleRequest,\n          {\n            spanName: `${method} ${srcPage}`,\n            kind: SpanKind.SERVER,\n            attributes: {\n              'http.method': method,\n              'http.target': req.url,\n            },\n          },\n          invokeRouteModule\n        )\n      )\n    }\n  } catch (err) {\n    // we re-throw in dev to show the error overlay\n    if (routeModule.isDev) {\n      throw err\n    }\n    // this is technically an invariant as error handling\n    // should be done inside of api-resolver onError\n    sendError(res as NextApiResponse, 500, 'Internal Server Error')\n  } finally {\n    // We don't allow any waitUntil work in pages API routes currently\n    // so if callback is present return with resolved promise since no\n    // pending work\n    ctx.waitUntil?.(Promise.resolve())\n  }\n}\n"],"names":["sendError","RouteKind","PagesAPIRouteModule","hoist","userland","getTracer","SpanKind","BaseServerSpan","addRequestMeta","config","routeModule","definition","kind","PAGES_API","page","pathname","bundlePath","filename","distDir","process","env","__NEXT_RELATIVE_DIST_DIR","relativeProjectDir","__NEXT_RELATIVE_PROJECT_DIR","handler","req","res","ctx","isDev","hrtime","bigint","srcPage","TURBOPACK","replace","prepareResult","prepare","statusCode","end","waitUntil","Promise","resolve","query","params","prerenderManifest","routerServerContext","method","tracer","activeSpan","getActiveScopeSpan","onRequestError","instrumentationOnRequestError","bind","invokeRouteModule","span","render","allowedRevalidateHeaderKeys","__NEXT_ALLOWED_REVALIDATE_HEADERS","multiZoneDraftMode","Boolean","__NEXT_MULTI_ZONE_DRAFT_MODE","trustHostHeader","__NEXT_TRUST_HOST_HEADER","previewProps","preview","propagateError","dev","internalRevalidate","revalidate","onError","args","finally","setAttributes","rootSpanAttributes","getRootSpanAttributes","get","handleRequest","console","warn","route","name","updateName","withPropagatedContext","headers","trace","spanName","SERVER","attributes","url","err"],"mappings":"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","ignoreList":[3]}